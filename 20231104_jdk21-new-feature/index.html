<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Exploring JDK 21 New Feature: Virtual Threads - JerrysBlog</title><meta name=Description content><meta property="og:title" content="Exploring JDK 21 New Feature: Virtual Threads"><meta property="og:description" content="JDK 21, the latest LTS release of OpenJDK, introduces an exciting new feature called Virtual Threads. In this blog post, we will delve into the details of this feature and explore how it enhances the scalability and performance of concurrent applications."><meta property="og:type" content="article"><meta property="og:url" content="https://jerrysmd.github.io/20231104_jdk21-new-feature/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-04T15:17:37+08:00"><meta property="article:modified_time" content="2023-11-04T15:17:37+08:00"><meta property="og:site_name" content="JerrysBlog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploring JDK 21 New Feature: Virtual Threads"><meta name=twitter:description content="JDK 21, the latest LTS release of OpenJDK, introduces an exciting new feature called Virtual Threads. In this blog post, we will delve into the details of this feature and explore how it enhances the scalability and performance of concurrent applications."><meta name=application-name content="JerrysBlog"><meta name=apple-mobile-web-app-title content="JerrysBlog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://cdn-icons-png.flaticon.com/128/5584/5584593.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://jerrysmd.github.io/20231104_jdk21-new-feature/><link rel=prev href=https://jerrysmd.github.io/20231103_track-sqlite-changes/><link rel=next href=https://jerrysmd.github.io/20231230_compression-algorithms-and-formats/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://unpkg.com/@fortawesome/fontawesome-free@6.2.0/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/@fortawesome/fontawesome-free@6.2.0/css/all.min.css></noscript><link rel=preload href=https://unpkg.com/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://unpkg.com/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Exploring JDK 21 New Feature: Virtual Threads","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jerrysmd.github.io\/20231104_jdk21-new-feature\/"},"genre":"posts","keywords":"Java, JDK, Multi Thread, Virtual Thread","wordcount":1125,"url":"https:\/\/jerrysmd.github.io\/20231104_jdk21-new-feature\/","datePublished":"2023-11-04T15:17:37+08:00","dateModified":"2023-11-04T15:17:37+08:00","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/jerrysmd.github.io\/images\/avatar.png"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=JerrysBlog><span class=header-title-pre><i class='far fa-edit fa-fw' aria-hidden=true></i></span>JERRYSBLOG</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/ title=Home>Home </a><a class=menu-item href=/categories/technology/ title="Technology article list">Technology </a><a class=menu-item href=/categories/life/ title="Life article list">Life </a><a class=menu-item href=/tags/ title="Tags cloud">Tags </a><a class=menu-item href=/about/ title="About blog">About </a><a class=menu-item href=https://github.com/Jerrysmd/ title="My GitHub" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><a class=menu-item href="https://jerrysmd.notion.site/c36b33378ab44eaa8a4e0d51acb419cd?v=f866caf0636341839c3ddd977cbb4bfe&pvs=4" title="My Bookshelf" rel="noopener noreffer" target=_blank><i class='fa-solid fa-book-bookmark fa-sm fa-fw' aria-hidden=true></i> </a><a class=menu-item href=https://Jerrysmd.github.io/gallery title="My Gallery" rel="noopener noreffer" target=_blank><i class='fa-solid fa-images fa-sm fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-moon fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=JerrysBlog><span class=header-title-pre><i class='far fa-edit fa-fw' aria-hidden=true></i></span>JERRYSBLOG</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title=Home>Home</a><a class=menu-item href=/categories/technology/ title="Technology article list">Technology</a><a class=menu-item href=/categories/life/ title="Life article list">Life</a><a class=menu-item href=/tags/ title="Tags cloud">Tags</a><a class=menu-item href=/about/ title="About blog">About</a><a class=menu-item href=https://github.com/Jerrysmd/ title="My GitHub" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a class=menu-item href="https://jerrysmd.notion.site/c36b33378ab44eaa8a4e0d51acb419cd?v=f866caf0636341839c3ddd977cbb4bfe&pvs=4" title="My Bookshelf" rel="noopener noreffer" target=_blank><i class='fa-solid fa-book-bookmark fa-sm fa-fw' aria-hidden=true></i></a><a class=menu-item href=https://Jerrysmd.github.io/gallery title="My Gallery" rel="noopener noreffer" target=_blank><i class='fa-solid fa-images fa-sm fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-moon fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Exploring JDK 21 New Feature: Virtual Threads</h1><div class=post-meta><div class=post-meta-line><span class=post-category>Category
<a href=/categories/technology/><i class="far fa-folder fa-fw" aria-hidden=true></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-11-04>2023-11-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1125 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;<span id=/20231104_jdk21-new-feature/ class=leancloud_visitors data-flag-title="Exploring JDK 21 New Feature: Virtual Threads">
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#overview>Overview</a><ul><li><a href=#release-information>Release information</a></li><li><a href=#oracle-java-se-support-roadmap>Oracle Java SE Support Roadmap</a></li><li><a href=#release-step>Release step</a></li><li><a href=#new-features>New features</a></li></ul></li><li><a href=#virtual-threads>Virtual Threads</a><ul><li><a href=#overview-1>Overview</a></li><li><a href=#why-virtual-threads>Why virtual threads</a></li><li><a href=#code>Code</a></li></ul></li><li><a href=#other-features>Other Features</a><ul><li><a href=#sequedced-collections>Sequedced Collections</a></li><li><a href=#deprecate-the-32-bit-x86-port-for-removal>Deprecate the 32-bit x86 port for Removal</a></li><li><a href=#prepare-to-disallow-the-dynamic-loading-of-agents>Prepare to disallow the Dynamic Loading of Agents</a></li><li><a href=#generational-zgc>Generational ZGC</a></li><li><a href=#pattern-matching-for-switch>Pattern Matching for switch</a></li><li><a href=#record-patterns>Record Patterns</a></li><li><a href=#kem>KEM</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>JDK 21, the latest LTS release of OpenJDK, introduces an exciting new feature called Virtual Threads. In this blog post, we will delve into the details of this feature and explore how it enhances the scalability and performance of concurrent applications.</p><h2 id=overview>Overview</h2><ul><li>From <a href=#release rel>Release Information</a>, JDK 21 will be a <code>long-term support (LTS)</code> release</li><li>And in 2023/09/19 JDK 21 <code>General Availability</code></li><li>JDK release step: <strong>Alpha &ndash;> Beta &ndash;> Release Candidate &ndash;> General Availability &ndash;> Release &ndash;> Stable</strong></li><li>From <a href=#roadmap rel>Oracle Java SE Support Roadmap</a>, Basically one LTS is released after every four non-LTS releases, so that <strong>JDK 8, JDK 11 and JDK 21</strong> are important in release history.</li></ul><h3 id=release-information>Release information</h3><p><a id=release></a></p><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/image-20231101152136597.png title=image-20231101152136597 data-thumbnail=/20231104_jdk21-new-feature/image-20231101152136597.png data-sub-html="<h2> </h2><p>image-20231101152136597</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/image-20231101152136597.png data-srcset="/20231104_jdk21-new-feature/image-20231101152136597.png, /20231104_jdk21-new-feature/image-20231101152136597.png 1.5x, /20231104_jdk21-new-feature/image-20231101152136597.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/image-20231101152136597.png width=740 height=816></a><figcaption class=image-caption></figcaption></figure></p><h3 id=oracle-java-se-support-roadmap>Oracle Java SE Support Roadmap</h3><p><a id=roadmap></a></p><table><thead><tr><th>Release</th><th>GA Date</th><th>Premier Support Until</th><th>Extended Support Until</th><th>Sustaining Support</th></tr></thead><tbody><tr><td>8﻿ (LTS)**</td><td>March 2014</td><td>March 2022</td><td>December 2030*****</td><td>Indefinite</td></tr><tr><td>9 - 10﻿ (non-LTS)</td><td>September 2017 - March 2018</td><td>March 2018 - September 2018</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>11 (LTS)</td><td>September 2018</td><td>September 2023</td><td>January 2032</td><td>Indefinite</td></tr><tr><td>12 - 16 (non-LTS)</td><td>March 2019 - March 2021</td><td>September 2019 - September 2021</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>17 (LTS)</td><td>September 2021</td><td>September 2026****</td><td>September 2029****</td><td>Indefinite</td></tr><tr><td>18 (non-LTS)</td><td>March 2022</td><td>September 2022</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>19 (non-LTS)</td><td>September 2022</td><td>March 2023</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>20 (non-LTS)</td><td>March 2023</td><td>September 2023</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>21 (LTS)***</td><td>September 2023</td><td>September 2028</td><td>September 2031</td><td>Indefinite</td></tr><tr><td>22 (non-LTS)***</td><td>March 2024</td><td>September 2024</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>23 (non-LTS)***</td><td>September 2024</td><td>March 2025</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>24 (non-LTS)***</td><td>March 2025</td><td>September 2025</td><td>Not Available</td><td>Indefinite</td></tr><tr><td>25 (LTS)***</td><td>September 2025</td><td>September 2033****</td><td>Not Available</td><td>Indefinite</td></tr></tbody></table><h3 id=release-step>Release step</h3><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/image-20231101153738703.png title=image-20231101153738703 data-thumbnail=/20231104_jdk21-new-feature/image-20231101153738703.png data-sub-html="<h2> </h2><p>image-20231101153738703</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/image-20231101153738703.png data-srcset="/20231104_jdk21-new-feature/image-20231101153738703.png, /20231104_jdk21-new-feature/image-20231101153738703.png 1.5x, /20231104_jdk21-new-feature/image-20231101153738703.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/image-20231101153738703.png width=809 height=383></a><figcaption class=image-caption></figcaption></figure></p><h3 id=new-features>New features</h3><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/image-20231101155956124.png title=image-20231101155956124 data-thumbnail=/20231104_jdk21-new-feature/image-20231101155956124.png data-sub-html="<h2> </h2><p>image-20231101155956124</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/image-20231101155956124.png data-srcset="/20231104_jdk21-new-feature/image-20231101155956124.png, /20231104_jdk21-new-feature/image-20231101155956124.png 1.5x, /20231104_jdk21-new-feature/image-20231101155956124.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/image-20231101155956124.png width=1264 height=871></a><figcaption class=image-caption></figcaption></figure></p><h2 id=virtual-threads>Virtual Threads</h2><h3 id=overview-1>Overview</h3><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png title=img data-thumbnail=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png data-sub-html="<h2> </h2><p>img</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png data-srcset="/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png, /20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png 1.5x, /20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png width=700 height=295></a><figcaption class=image-caption></figcaption></figure></p><p>Virtual Threads offers a more efficient and <code>lightweight thread model.</code></p><p>Virtual threads in JDK 21 are implemented using a concept called <code>"continuations."</code> Continuations allow threads to be suspended and resumed without the need for full thread context switching, resulting in a more efficient and lightweight threading model.</p><p>Traditionally, each thread in Java corresponds to an operating system thread, <strong>which involves significant overhead in terms of memory and context switching</strong>. In contrast, virtual threads are <strong>not directly mapped to OS threads. Instead, they are managed by a lightweight scheduler within the JVM.</strong></p><p>When a virtual thread encounters a <strong>blocking operation, such as waiting for I/O or synchronization, it can be suspended and its state is captured as a continuation</strong>. This continuation represents the thread&rsquo;s execution context, including the call stack and local variables. The virtual thread is then freed up to execute other tasks.</p><p><strong>Once the blocking operation completes, the virtual thread can be resumed from its captured continuation, allowing it to continue execution from the point where it was suspended. The resumption process does not involve the expensive thread context switching that occurs with traditional threads.</strong></p><p>By leveraging continuations and the lightweight scheduler, JDK 21&rsquo;s virtual threads provide a more efficient and scalable threading model, enabling developers to achieve higher levels of concurrency and responsiveness in their applications.</p><h3 id=why-virtual-threads>Why virtual threads</h3><div class=mermaid id=id-1></div><ul><li>The costs of threads include <strong>creation, destruction, frequent switching, and concurrency overhead.</strong></li><li>The costs of creation and destruction can be solved by <strong>Thread pool.</strong></li><li>Frequent switching and concurrency overhead can be solved by <strong>Virtual Threads</strong><ul><li>Cause Virtual Threads in the same Thread, so there is no costs of switching</li><li>Also, virtual threads greatly increase the number of &rsquo;threads'</li></ul></li></ul><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png title=img data-thumbnail=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png data-sub-html="<h2> </h2><p>img</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png data-srcset="/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png, /20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png 1.5x, /20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/0t_mVeMqHHrwso09p.png width=700 height=295></a><figcaption class=image-caption></figcaption></figure></p><h3 id=code>Code</h3><ul><li><p>The code for virtual threads is basically the same as for thread pools</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>try</span> <span class=o>(</span><span class=n>var</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newVirtualThreadPerTaskExecutor</span><span class=o>()){</span>
</span></span><span class=line><span class=cl>    <span class=n>IntStream</span><span class=o>.</span><span class=na>range</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=n>10_000</span><span class=o>).</span><span class=na>forEach</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>executor</span><span class=o>.</span><span class=na>submit</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=n>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>});</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>// executor.close() is called implicitly, and waits
</span></span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=other-features>Other Features</h2><h3 id=sequedced-collections>Sequedced Collections</h3><p>Java&rsquo;s collections framework lacks a sequence of elements representing a defined order. There is also a lack of a unified way to operate collections</p><p>Example:</p><table><thead><tr><th></th><th>First element</th><th>Last element</th></tr></thead><tbody><tr><td>List</td><td>list.get(0)</td><td>list.get(list.size() - 1)</td></tr><tr><td>Deque</td><td>deque.getFirst()</td><td>deque.getLast()</td></tr><tr><td>SortedSet</td><td>sortedSet.first()</td><td>sortedSet.last()</td></tr><tr><td>LinkedHashSet</td><td>linkedHashSet.iterator().next()</td><td>//missing</td></tr></tbody></table><p>New Sequedced Collections:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>SequencedCollenction</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>Collection</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// new method
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>SequencedCollection</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=nf>reversed</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// methods promoted from Deque
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>addFirst</span><span class=o>(</span><span class=n>E</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addLast</span><span class=o>(</span><span class=n>E</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>E</span> <span class=nf>geFirst</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>E</span> <span class=nf>getLast</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>E</span> <span class=nf>removeFirst</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>E</span> <span class=nf>removeLast</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/image-20231102162648946.png title=image-20231102162648946 data-thumbnail=/20231104_jdk21-new-feature/image-20231102162648946.png data-sub-html="<h2> </h2><p>image-20231102162648946</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/image-20231102162648946.png data-srcset="/20231104_jdk21-new-feature/image-20231102162648946.png, /20231104_jdk21-new-feature/image-20231102162648946.png 1.5x, /20231104_jdk21-new-feature/image-20231102162648946.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/image-20231102162648946.png width=958 height=501></a><figcaption class=image-caption></figcaption></figure></p><h3 id=deprecate-the-32-bit-x86-port-for-removal>Deprecate the 32-bit x86 port for Removal</h3><ul><li>64 bits are simulated by writing high 12 bits once and low 32 bits once</li></ul><h3 id=prepare-to-disallow-the-dynamic-loading-of-agents>Prepare to disallow the Dynamic Loading of Agents</h3><ul><li><p>Warning when the agent is dynamically loaded into a running JVM. These warnings are intended to prepare users for a future release that does not allow dynamic loading of the agent by default in order to improve integrity by default.</p></li><li><p>Dynamic loading agents allow developers to modify and monitor the behavior of Java applications at run time. While this is useful for debugging and performance analysis, there are also potential security risks. Malicious code may take advantage of dynamically loaded agents to perform malicious operations, such as fetching sensitive information, calculating data, and so on. Therefore, in order to strengthen the security of Java applications, it is necessary to limit the use of dynamically loaded agents</p></li></ul><h3 id=generational-zgc>Generational ZGC</h3><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/image-20231102211953084.png title=image-20231102211953084 data-thumbnail=/20231104_jdk21-new-feature/image-20231102211953084.png data-sub-html="<h2> </h2><p>image-20231102211953084</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/image-20231102211953084.png data-srcset="/20231104_jdk21-new-feature/image-20231102211953084.png, /20231104_jdk21-new-feature/image-20231102211953084.png 1.5x, /20231104_jdk21-new-feature/image-20231102211953084.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/image-20231102211953084.png width=1726 height=941></a><figcaption class=image-caption></figcaption></figure></p><h3 id=pattern-matching-for-switch>Pattern Matching for switch</h3><p><figure><a class=lightgallery href=/20231104_jdk21-new-feature/image-20231102212225874.png title=image-20231102212225874 data-thumbnail=/20231104_jdk21-new-feature/image-20231102212225874.png data-sub-html="<h2> </h2><p>image-20231102212225874</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/20231104_jdk21-new-feature/image-20231102212225874.png data-srcset="/20231104_jdk21-new-feature/image-20231102212225874.png, /20231104_jdk21-new-feature/image-20231102212225874.png 1.5x, /20231104_jdk21-new-feature/image-20231102212225874.png 2x" data-sizes=auto alt=/20231104_jdk21-new-feature/image-20231102212225874.png width=1487 height=809></a><figcaption class=image-caption></figcaption></figure></p><p>Pattern Matching comparing:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Before Java 21
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>static</span> <span class=n>String</span> <span class=nf>formatter</span><span class=o>(</span><span class=n>Object</span> <span class=n>obj</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>formatted</span> <span class=o>=</span> <span class=s>&#34;unknown&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>obj</span> <span class=k>instanceof</span> <span class=n>Integer</span> <span class=n>i</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=n>formatted</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;int %d&#34;</span><span class=o>,</span> <span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=k>instanceof</span> <span class=n>Long</span> <span class=n>l</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=n>formatted</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;long %d&#34;</span><span class=o>,</span> <span class=n>l</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=k>instanceof</span> <span class=n>Double</span> <span class=n>d</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=n>formatted</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;double %f&#34;</span><span class=o>,</span> <span class=n>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=k>instanceof</span> <span class=n>String</span> <span class=n>s</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=n>formatted</span> <span class=o>=</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;String %s&#34;</span><span class=o>,</span> <span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>formatted</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// In Java 21
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>static</span> <span class=n>String</span> <span class=nf>formatterPatternSwitch</span><span class=o>(</span><span class=n>Object</span> <span class=n>obj</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>switch</span><span class=o>(</span><span class=n>obj</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>Integer</span> <span class=n>i</span> <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;int %d&#34;</span><span class=o>,</span> <span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>Long</span> <span class=n>l</span>    <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;long %d&#34;</span><span class=o>,</span> <span class=n>l</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>Double</span> <span class=n>d</span>  <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;double %f&#34;</span><span class=o>,</span> <span class=n>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=n>String</span> <span class=n>s</span>  <span class=o>-&gt;</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;String %s&#34;</span><span class=o>,</span> <span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span> <span class=o>-&gt;</span> <span class=n>obj</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Before Java 21
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>s</span> <span class=o>==</span> <span class=kc>null</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=o>(</span><span class=s>&#34;oops&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>reutrn</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span><span class=o>(</span><span class=n>s</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;Foo&#34;</span><span class=o>,</span> <span class=s>&#34;Bar&#34;</span> <span class=o>-&gt;</span> <span class=n>println</span><span class=o>(</span><span class=s>&#34;great&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span>           <span class=o>-&gt;</span> <span class=n>println</span><span class=o>(</span><span class=s>&#34;OK&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// In Java 21
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span><span class=o>(</span><span class=n>s</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=kc>null</span>         <span class=o>-&gt;</span> <span class=n>println</span><span class=o>(</span><span class=s>&#34;oops&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;Foo&#34;</span><span class=o>,</span> <span class=s>&#34;Bar&#34;</span> <span class=o>-&gt;</span> <span class=n>println</span><span class=o>(</span><span class=s>&#34;great&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span>           <span class=o>-&gt;</span> <span class=n>println</span><span class=o>(</span><span class=s>&#34;OK&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=record-patterns>Record Patterns</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// In Java 21
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>static</span> <span class=kt>void</span> <span class=nf>printsum</span><span class=o>(</span><span class=n>Object</span> <span class=n>obj</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>obj</span> <span class=k>instanceof</span> <span class=nf>point</span><span class=o>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>,</span> <span class=kt>int</span> <span class=n>y</span><span class=o>)){</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=o>(</span><span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=kem>KEM</h3><p>Key Encapsulation Mechanism API</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Receiver side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>var</span> <span class=n>kpg</span> <span class=o>=</span> <span class=n>KeyPairGenerator</span><span class=o>.</span><span class=na>getInstance</span><span class=o>(</span><span class=s>&#34;x2551g&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>kp</span> <span class=o>=</span> <span class=n>kpg</span><span class=o>.</span><span class=na>generateKeyPair</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=c1>// sender side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>var</span> <span class=n>kem1</span> <span class=o>=</span> <span class=n>KEM</span><span class=o>.</span><span class=na>getInstance</span><span class=o>(</span><span class=s>&#34;DHKEM&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>sender</span> <span class=o>=</span> <span class=n>kem1</span><span class=o>.</span><span class=na>newEncapsulator</span><span class=o>(</span><span class=n>kp</span><span class=o>.</span><span class=na>getpublic</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>encapsulated</span> <span class=o>=</span> <span class=n>sender</span><span class=o>.</span><span class=na>encapsulate</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>k1</span> <span class=o>=</span> <span class=n>encapsulated</span><span class=o>.</span><span class=na>key</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Receiver side
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>var</span> <span class=n>kem2</span> <span class=o>=</span> <span class=n>KEM</span><span class=o>.</span><span class=na>getInstanceC</span><span class=s>&#34;DHKEM&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>receiver</span> <span class=o>=</span> <span class=n>kem2</span><span class=o>.</span><span class=na>newDecapsulator</span><span class=o>(</span><span class=n>kp</span><span class=o>.</span><span class=na>getprivate</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>k2</span> <span class=o>=</span> <span class=n>receiver</span><span class=o>.</span><span class=na>decapsulate</span><span class=o>(</span><span class=n>encapsulated</span><span class=o>.</span><span class=na>encapsulation</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>kl</span><span class=o>.</span><span class=na>getEncoded</span><span class=o>(),</span> <span class=n>k2</span><span class=o>.</span><span class=na>getEncoded</span><span class=o>());</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/java/>Java</a>,&nbsp;<a href=/tags/jdk/>JDK</a>,&nbsp;<a href=/tags/multi-thread/>Multi Thread</a>,&nbsp;<a href=/tags/virtual-thread/>Virtual Thread</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/20231103_track-sqlite-changes/ class=prev rel=prev title="Tracking SQLite Database Changes in Git"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Tracking SQLite Database Changes in Git</a>
<a href=/20231230_compression-algorithms-and-formats/ class=next rel=next title="Striking a Balance Between Speed and Compression Ratio: The Relationship Between Compression Algorithms and Formats">Striking a Balance Between Speed and Compression Ratio: The Relationship Between Compression Algorithms and Formats<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2024</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://unpkg.com/lightgallery@2.6.1/css/lightgallery-bundle.min.css><script type=text/javascript src=https://unpkg.com/valine@1.5.1/dist/Valine.min.js></script><script type=text/javascript src=https://unpkg.com/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://unpkg.com/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery@2.6.1/lightgallery.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery@2.6.1/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://unpkg.com/lightgallery@2.6.1/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=https://unpkg.com/mermaid@9.4.3/dist/mermaid.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:40},comment:{valine:{appId:"2jSYKh8PFUje3v7Ie3Nn5v1g-gzGzoHsz",appKey:"MyWn4P9G5N32q3oM5JDnlpdL",avatar:"retro",el:"#valine",emojiCDN:"https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/",enableQQ:!0,highlight:!0,lang:"en",meta:["nick","mail"],pageSize:10,placeholder:"Your comment ...",recordIP:!0,visitor:!0}},data:{"id-1":`flowchart LR
   Thread-cost --\u003e CreateAndDestroy --\u003e solution:thread-pool
   Thread-cost --\u003e thread-switch --\u003e solution:virutal-threads
   Thread-cost --\u003e concurrent-value --\u003e b[solution:virutal-threads]`},lightgallery:!0,search:{algoliaAppID:"BADKNNRXHD",algoliaIndex:"index",algoliaSearchKey:"7a8c2923330a44bdd9985698e3f28e0c",highlightTag:"em",maxResultLength:8,noResultsFound:"No results found",snippetLength:40,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JJBX835T6W")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-JJBX835T6W" async></script></body></html>