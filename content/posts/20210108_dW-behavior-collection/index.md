---
title: "Data Warehouse: Offline" # Title of the blog post.
date: 2021-01-08T09:43:01+08:00 # Date of post creation.
description: "" # Description used for search engine.
featured: true # Sets if post is a featured post, making appear on the home page side bar.
draft: false # Sets whether to render this page. Draft of true will not be rendered.
toc: false # Controls if a table of contents should be generated for first-level links automatically.
# thumbnail: "images/distribution2.png" # Sets thumbnail image appearing inside card on homepage.
# featureImage: "/images/path/file.jpg" # Sets featured image on blog post.
# featureImageAlt: 'Description of image' # Alternative text for featured image.
# featureImageCap: 'This is the featured image.' # Caption (optional).
codeLineNumbers: true # Override global value for showing of line numbers within code block.
codeMaxLines: 40 # Override global value for how many lines within a code block before auto-collapsing.
codeLineNumbers: true # Override global value for showing of line numbers within code block.
figurePositionShow: true # Override global value for showing the figure label.
usePageBundles: true # Set to true to group assets like images in the same folder as this post.
categories:
  - Technology
tags:
  - Dataware house
  - Distribution
comments: true # Disable comment if false.
---

Data warehouse is a system that pulls together data derived from operational systems and external data sources within an organization for reporting and analysis. A data warehouse is a central repository of information that provides users with current and historical decision support information.

<!--more-->

## æ•°æ®ä»“åº“

### æ¦‚å¿µ

+ ä¸šåŠ¡æ•°æ®ï¼š

  å¤„ç†äº‹åŠ¡è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ã€‚ç™»å½•ã€ä¸‹å•ã€æ”¯ä»˜ã€‚

+ ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼š

  ä¸å®¢æˆ·ç«¯äº§å“äº¤äº’è¿‡ç¨‹äº§ç”Ÿçš„æ•°æ®ã€‚æµè§ˆã€ç‚¹å‡»ã€åœç•™ã€‚

![dataWarehouse_introduction](dataWarehouse_introduction.jpg "offline DW process")

> æ•°ä»“æ˜¯å¯¹æ•°æ®è¿›è¡Œ **å¤‡ä»½ã€æ¸…æ´—ã€èšåˆã€ç»Ÿè®¡** ç­‰æ“ä½œã€‚
>
> ODSåŸå§‹æ•°æ®å±‚ï¼›DWDæ˜ç»†æ•°æ®å±‚ï¼›DWSæœåŠ¡æ•°æ®å±‚ï¼›DWTæ•°æ®ä¸»é¢˜å±‚ï¼›ADSæ•°æ®åº”ç”¨å±‚

### æŠ€æœ¯ç»„ä»¶

+ æ•°æ®é‡‡é›†ä¼ è¾“ï¼š`Flumeï¼ŒKafkaï¼ŒDataX`ï¼ŒSqoopï¼ŒLogstash
+ æ•°æ®å­˜å‚¨ï¼š`MySQLï¼ŒHDFSï¼ŒHBASE`ï¼ŒRedisï¼ŒMongoDB
+ æ•°æ®è®¡ç®—ï¼š`Hiveï¼ŒSpark`ï¼ŒFlinkï¼ŒTezï¼ŒStorm
+ æ•°æ®æŸ¥è¯¢ï¼š`Prestoï¼ŒKylin`ï¼ŒImpalaï¼ŒDruid
+ æ•°æ®å¯è§†åŒ–ï¼šEchartsã€`Superset`ã€QuickBIã€DataV
+ ä»»åŠ¡è°ƒåº¦ï¼šAzkabanã€Oozie
+ é›†ç¾¤ç›‘æ§ï¼šZabbix
+ å…ƒæ•°æ®ç®¡ç†ï¼šAtlas
+ æƒé™ç®¡ç†ï¼šRanger

### ç³»ç»Ÿæµç¨‹å›¾

![system_design](system_design.jpg "system_design")

+ `ä¸šåŠ¡æ•°æ® / å‰ç«¯ js åŸ‹ç‚¹è¡Œä¸ºæ•°æ®ï¼š`æŒä¹…åŒ–æˆ–ä¸æŒä¹…åŒ–å†™å…¥æ•°æ®åº“ã€‚

+ `Nginxï¼š`è´Ÿè½½å‡è¡¡ï¼Œä½¿æ¯ä¸ªèŠ‚ç‚¹æ•°æ®é‡ä¿æŒåˆç†ã€‚

+ `Flumeï¼š`é‡‡é›†æ—¥å¿—ã€‚å¯ä»¥ç›´æ¥é‡‡é›†åˆ° Hadoopï¼Œä½† hadoop å¯èƒ½å¤„ç†å¾ˆæ…¢ï¼Œå¦‚åŒ11ã€‚å¯ä»¥å…ˆå†™åˆ° Kafka é‡Œã€‚

  Flume ç»„æˆï¼ŒPut äº‹åŠ¡ï¼ŒTake äº‹åŠ¡

  Flume ä¸‰ä¸ªå™¨ï¼šæ‹¦æˆªå™¨ï¼Œé€‰æ‹©å™¨ï¼Œç›‘æ§å™¨

  Flume ä¼˜åŒ–ï¼šå†…å­˜ï¼Œå°æ•°

+ `Kafkaï¼š`23 ä»¶äº‹

  1.kafkaåŸºæœ¬ä¿¡æ¯ 2.æŒ‚äº† 3.ä¸¢å¤± 4.é‡å¤ 5.ç§¯å‹ 6.ä¼˜åŒ– 7.é«˜æ•ˆè¯»å†™çš„åŸå› 

+ `Zookeeperï¼š`åˆ†å¸ƒå¼åè°ƒ

  1.éƒ¨ç½²å¤šå°‘å° 2.é€‰ä¸¾æœºåˆ¶ï¼ŒPaxosç®—æ³•

+ `Flumeï¼š` æ¶ˆè´¹ä¼ åˆ° Hadoop

+ `Hiveï¼š` 1.Hiveå†…éƒ¨è¡¨ã€å¤–éƒ¨è¡¨åŒºåˆ« 2.4ä¸ªby 3.ç³»ç»Ÿå‡½æ•° 4.UDFã€UDTFå‡½æ•° 5.çª—å£å‡½æ•° 6.Hiveä¼˜åŒ– 7.æ•°æ®å€¾æ–œ 8.Hiveå¼•æ“ 9.å…ƒæ•°æ®å¤‡ä»½

### é›†ç¾¤é…ç½®

é…ç½®åŸåˆ™:

1. æ¶ˆè€—å†…å­˜çš„ç»„ä»¶è¦åˆ†å¼€ï¼šHDFS çš„ NameNodeã€Yarn çš„ ResourceManager åˆ†å¼€é…ç½®
2. kafkaã€zkã€flume ä¼ è¾“æ•°æ®æ¯”è¾ƒç´§å¯†çš„æ”¾åœ¨ä¸€èµ·
3. å®¢æˆ·ç«¯æ”¾åœ¨ä¸€åˆ°ä¸¤å°æœåŠ¡å™¨ä¸Šï¼Œæ–¹ä¾¿å¤–éƒ¨è®¿é—®

## æ•°æ®é‡‡é›†æ¨¡å—

### Hadoop

>ä¼˜åŒ–ï¼š
>
>1. æ•°æ®å‡è¡¡ï¼šèŠ‚ç‚¹ä¸èŠ‚ç‚¹é—´ï¼Œç£ç›˜ä¸ç£ç›˜é—´ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å‘½ä»¤ä½¿æ•°æ®å‡è¡¡ï¼Œthreshold è®¾ç½®å·®å€¼ã€‚
>
>2. LZO å‹ç¼©ï¼šhadoop é¢å¤–æ”¯æŒ gzipã€Snappyã€Lzoã€Lzop(åˆ†ç‰‡) å‹ç¼©æ–¹å¼ã€‚LZOåˆ›å»ºç´¢å¼•åå¯ä»¥å®ç°åˆ†ç‰‡ã€‚
>
>   éœ€è¦å‹ç¼©çš„ä¸‰ä¸ªåœ°æ–¹ï¼š
>
>|                                                    | Map  |        | Reduce |                                                              |
>| -------------------------------------------------- | ---- | ------ | ------ | ------------------------------------------------------------ |
>| è¾“å…¥ç«¯                                             |      | å¿«     |        | è¾“å‡ºç«¯                                                       |
>| å…ˆè€ƒè™‘æ•°æ®é‡<br>1.å° => å¿«                         |      | snappy |        | çœ‹éœ€æ±‚<br>1.æ°¸ä¹…ä¿å­˜ï¼šå‹ç¼©è¶Šå°è¶Šå¥½                           |
>| 2.æ•°æ®é‡å¤§ => åˆ‡ç‰‡<br>bzip2<br>lzo => éœ€è¦åˆ›å»ºç´¢å¼• |      | lzo    |        | 2.ä¸‹ä¸€ä¸ªmapreduceè¾“å…¥ç«¯<br>æ•°æ®é‡å° => å¿«<br>æ•°æ®é‡å¤§ => åˆ‡ç‰‡ å‹ç¼© |
>
>3. HDFSå‚æ•°è°ƒä¼˜ï¼š
>   1. å¯¹äºå¤§é›†ç¾¤æˆ–è€…å¤§é‡å®¢æˆ·ç«¯çš„é›†ç¾¤æ¥è¯´ï¼Œé€šå¸¸éœ€è¦è°ƒå¤§ dfs.namenode.handler.count çš„ä¸ªæ•°ï¼Œé»˜è®¤å€¼ä¸º10ä¸ªã€‚å»ºè®®è°ƒæ•´ä¸º 20 * loge<sup>cluster size</sup>
>4. Yarnå‚æ•°è°ƒä¼˜ yarn-site.xmlï¼š
>   1. æƒ…æ™¯æè¿°ï¼šæ€»å…±7å°æœºå™¨ï¼Œæ¯å¤©å‡ äº¿æ¡æ•°æ®ï¼Œæ•°æ®æº -> Flume -> Kafka -> HDFS -> Hive
>   2. é—®é¢˜ï¼šæ•°æ®ç»Ÿè®¡ä¸»è¦ç”¨ HiveSQLï¼Œæ²¡æœ‰æ•°æ®å€¾æ–œï¼Œå°æ–‡ä»¶å·²ç»åšäº†åˆå¹¶å¤„ç†ï¼Œå¼€å¯äº† JVM é‡ç”¨ï¼Œè€Œä¸”IO æ²¡æœ‰é˜»å¡ï¼Œ**å†…å­˜ç”¨äº†ä¸åˆ° 50%**ï¼Œä½†è¿˜æ˜¯è·‘çš„éå¸¸æ…¢ï¼Œè€Œä¸”æ•°æ®é‡æ´ªå³°æ—¶ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½ä¼šå®•æ‰ï¼ŒåŸºäºè¿™ç§æƒ…å†µçš„ä¼˜åŒ–æ–¹æ¡ˆæ˜¯ä»€ä¹ˆã€‚
>   3. è§£å†³åŠæ³•ï¼šå…¸å‹çš„å†…å­˜åˆ©ç”¨ç‡ä¸å¤Ÿï¼Œä¸€èˆ¬æ˜¯ Yarn çš„2ä¸ªé…ç½®é€ æˆçš„ï¼Œ**å•ä¸ªä»»åŠ¡å¯ä»¥ç”³è¯·çš„æœ€å¤§å†…å­˜å¤§å°**ï¼Œå’Œ **Hadoop å•ä¸ªèŠ‚ç‚¹å¯ç”¨å†…å­˜å¤§å°**ã€‚è°ƒèŠ‚è¿™ä¸¤ä¸ªå‚æ•°èƒ½æé«˜ç³»ç»Ÿå†…å­˜çš„åˆ©ç”¨ç‡ã€‚ ï¼ˆNodeManager é»˜è®¤å†…å­˜å¤§å° 8gï¼Œå•ä¸ªä»»åŠ¡é»˜è®¤å†…å­˜å¤§å° 8gï¼Œmaptaské»˜è®¤å†…å­˜å¤§å° 1gï¼Œreducetaské»˜è®¤å†…å­˜å¤§å° 1gã€‚ï¼‰NodeManagerå†…å­˜æ”¹ä¸ºèŠ‚ç‚¹ 80% å·¦å³çš„å†…å­˜å¤§å°ã€‚å•ä¸ªä»»åŠ¡å†…å­˜å¤§å°æ ¹æ®æ¯ 128M æ•°æ®åˆ†é…1gå†…å­˜ã€‚maptask å’Œ reducetask å†…å­˜è‹¥ä¸æ”¯æŒå‹ç¼©ä¹Ÿéœ€è¦è°ƒå¤§ã€‚

### Zookeeper

### Kafka

> kafka æœºå™¨æ•°é‡è®¡ç®—ï¼š
>
> æœºå™¨æ•°é‡ï¼ˆç»éªŒå…¬å¼ï¼‰= 2 *ï¼ˆå³°å€¼ç”Ÿäº§é€Ÿåº¦ * å‰¯æœ¬æ•° / 100) + 1
>
> å…ˆé€šè¿‡å‹æµ‹æ‹¿åˆ°å³°å€¼ç”Ÿäº§é€Ÿåº¦ï¼Œæ¯”å¦‚å³°å€¼ç”Ÿäº§é€Ÿåº¦æ˜¯ 50M/sã€‚å‰¯æœ¬æ•°é»˜è®¤æ˜¯1ä¸ªï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥è®¾ç½®ä¸º2ã€‚Kafka æœºå™¨æ•°é‡ = 2 * ï¼ˆ50 * 2 / 100ï¼‰+ 1 = 3 å°ã€‚

> kafka producer ç”Ÿäº§è€…å‹åŠ›æµ‹è¯•ï¼š
>
> ```shell
> bin/kafka-producer-perf-test.sh --topic test --record-size 100 --num-records 100000 --throughput -1 --producer-props bootstrap.servers=hadoop102:9092,hadoop103:9092
> ```
>
> å‚æ•°è¯´æ˜ï¼š
>
> --record-sizeï¼šæ˜¯ä¸€æ¡ä¿¡æ¯æœ‰å¤šå¤§ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚
>
> --num-recordsï¼šæ˜¯æ€»å…±å‘é€å¤šå°‘æ¡ä¿¡æ¯ã€‚
>
> --throughputï¼šæ˜¯æ¯ç§’å¤šå°‘æ¡ä¿¡æ¯ï¼Œè®¾æˆ-1è¡¨ç¤ºä¸é™æµï¼Œå¯æµ‹å‡ºç”Ÿäº§è€…æœ€å¤§ååé‡ã€‚

> kafka consumer æ¶ˆè´¹è€…å‹åŠ›æµ‹è¯•ï¼š
>
> å¦‚æœ IOã€CPUã€å†…å­˜ã€ç½‘ç»œ è¿™å››ä¸ªæŒ‡æ ‡éƒ½ä¸èƒ½æ”¹å˜ï¼Œè€ƒè™‘å¢åŠ åˆ†åŒºæ•°æ¥æå‡æ€§èƒ½ã€‚
>
> å‚æ•°è¯´æ˜ï¼š
>
> --broker-listï¼šæŒ‡å®š kafka é›†ç¾¤åœ°å€
>
> --topicï¼šæŒ‡å®š topic çš„åç§°
>
> --fetch-sizeï¼šæŒ‡å®šæ¯æ¬¡ fetch çš„æ•°æ®å¤§å°
>
> --messagesï¼šæ€»å…±è¦æ¶ˆè´¹çš„æ¶ˆæ¯ä¸ªæ•°

> kafka åˆ†åŒºæ•°è®¡ç®—ï¼š
>
> 1. åˆ›å»ºä¸€ä¸ªåªæœ‰ä¸€ä¸ªåˆ†åŒºçš„topic
> 2. æµ‹è¯•è¿™ä¸ª topic çš„ producer ååé‡å’Œ consumer ååé‡ã€‚
> 3. å‡è®¾ä»–ä»¬çš„å€¼æ˜¯ Tp å’Œ Tcï¼Œå•ä½æ˜¯ MB/sã€‚
> 4. ç„¶åå‡è®¾æ€»çš„ç›®æ ‡ååé‡æ˜¯ Ttï¼Œé‚£ä¹ˆåˆ†åŒºæ•° = Tt/min( Tpï¼ŒTc)
> 5. åˆ†åŒºæ•°ä¸€èˆ¬è®¾ç½®ä¸ºï¼š3 - 10ä¸ª

### Flume

> Flume ç»„ä»¶é€‰å‹
>
> 1. Sourceï¼š
>
>    1. Taildir Sourceï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€å¤šç›®å½•ã€‚ä½†å¯èƒ½æœ‰æ•°æ®é‡å¤ï¼ˆé‡å¤æ•°æ®åœ¨ä¸‹ä¸€çº§è§£å†³ï¼šåœ¨ hive çš„ dwd å±‚ã€spark streaming ä½¿ç”¨ group byã€å¼€çª—å–çª—å£ç¬¬ä¸€æ¡æ•°æ®ï¼‰
>
> 2. Channelï¼š
>
>    1. kafka channelï¼šæ•°æ®å­˜æ”¾åœ¨ kafka é‡Œé¢ã€‚kafka æ•°æ®å­˜åœ¨ç£ç›˜é‡Œã€‚
>
>       **åŸºäºç£ç›˜ï¼Œå¯é æ€§é«˜** 
>
>       kafka channel > memory channel + kafka sink
>
>       å¦‚æœä¸‹ä¸€çº§æ˜¯ kafkaï¼Œä¼˜å…ˆé€‰æ‹© kafka channel
>
>       å¦‚æœä¸‹ä¸€çº§ä¸æ˜¯ kafkaï¼Œå¯¹å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œé‡‘èé¢†åŸŸï¼Œä¼˜å…ˆé€‰æ‹© file channel
>
>       å¦‚æœä¸‹ä¸€çº§ä¸æ˜¯ kafkaï¼Œå¯¹å¯é æ€§è¦æ±‚ä¸é«˜ï¼Œé€‰æ‹© memory channelï¼Œè¿½æ±‚æ•ˆç‡
>
>       kafka channel 1.6ç‰ˆæœ¬äº§ç”Ÿï¼Œä½†æœ‰ bug äº§ç”Ÿçš„æ•°æ®æ˜¯ header + å†…å®¹ï¼Œ1.7 ç‰ˆæœ¬è§£å†³

> Flume æ‹¦æˆªå™¨
>
> Flume æ¶ˆè´¹ Kafka é‡Œé¢çš„æ•°æ®æ—¶ï¼Œå¯èƒ½å·²ç»æ˜¯ç¬¬äºŒå¤©ï¼Œæ•°æ®æœ‰å¯èƒ½å‘å¾€ç¬¬äºŒå¤©çš„ HDFS è·¯å¾„ã€‚
>
> è§£å†³æ€è·¯ï¼šæ‹¦æˆª json æ—¥å¿—ï¼Œé€šè¿‡ fastjson è§£æ jsonï¼Œè·å–å®é™…æ—¶é—´ tsã€‚å°†è·å–çš„ ts æ—¶é—´å†™å…¥æ‹¦æˆªå™¨ header å¤´ï¼Œheader çš„ key å¿…é¡»æ˜¯ **timestampï¼Œå› ä¸º Flume æ¡†æ¶ä¼šæ ¹æ®è¿™ä¸ª key çš„å€¼è¯†åˆ«ä¸ºæ—¶é—´ï¼Œå†™å…¥åˆ° HDFSã€‚**
>
> 1. åˆ›å»º Maven å·¥ç¨‹ flume-interceptor
> 2. åˆ›å»ºåŒ…åï¼šcom.whatever.flume.interceptor
> 3. åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ é…ç½®
> 4. åœ¨ com.whatever.flume.interceptor åŒ…ä¸‹åˆ›å»º JSONUtils ç±»
> 5. åœ¨ com.whatever.flume.interceptor åŒ…ä¸‹åˆ›å»º ETLInterceptor ç±»ï¼Œé‡å†™æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆ JSON æ ¼å¼
> 6. æ‰“åŒ…ï¼Œåˆ†å‘åˆ° Flume èŠ‚ç‚¹

> ![flume_scs](flume_scs.jpg "flume_scs")

> Flumeä¼˜åŒ–ï¼š
>
> 1. å†…å­˜å‚æ•°è®¾ç½®ä¼˜åŒ–ï¼š
>    1. JVM heap ä¸€èˆ¬è®¾ç½®ä¸º 4G æˆ–æ›´é«˜
>    2. -Xmxï¼ˆå¯åŠ¨å†…å­˜ï¼‰ ä¸ -Xmsï¼ˆè¿è¡Œå†…å­˜ï¼‰ æœ€å¥½è®¾ç½®ä¸€è‡´ï¼Œå‡å°‘å†…å­˜æŠ–åŠ¨å¸¦æ¥çš„æ€§èƒ½å½±å“ï¼Œå¦‚æœä¸ä¸€è‡´å®¹æ˜“å€’ç½® fullgc

### DataX

> åŒæ­¥ç­–ç•¥ï¼š
>
> | åŒæ­¥ç­–ç•¥ | ä¼˜ç‚¹                           | ç¼ºç‚¹     |
> | -------- | ------------------------------ | -------- |
> | å…¨é‡åŒæ­¥ | é€»è¾‘ç®€å•                       | æ•ˆç‡ä½   |
> | å¢é‡åŒæ­¥ | æ•ˆç‡é«˜ï¼Œæ— éœ€åŒæ­¥å’Œå­˜å‚¨é‡å¤æ•°æ® | é€»è¾‘å¤æ‚ |
>

> DadaX ç›¸æ¯” Sqoop åŠŸèƒ½æ›´å¼ºå¤§ï¼š
>
> | åŠŸèƒ½     | DataX                          | Sqoop                |
> | -------- | ------------------------------ | -------------------- |
> | è¿è¡Œæ¨¡å¼ | å•è¿›ç¨‹å¤šçº¿ç¨‹                   | MR                   |
> | åˆ†å¸ƒå¼   | ä¸æ”¯æŒ<br>å¯ä»¥é€šè¿‡è°ƒåº¦ç³»ç»Ÿè§„é¿ | æ”¯æŒ                 |
> | æµæ§     | æœ‰                             | éœ€å®šåˆ¶               |
> | ç»Ÿè®¡ä¿¡æ¯ | æœ‰                             | åˆ†å¸ƒå¼æ•°æ®æ”¶é›†ä¸æ–¹ä¾¿ |
> | æ•°æ®æ ¡éªŒ | æœ‰                             | éœ€å®šåˆ¶               |
> | ç›‘æ§     | éœ€å®šåˆ¶                         | éœ€å®šåˆ¶               |

> DataX è°ƒåº¦å†³ç­–æ€è·¯ï¼š
>
> ä¸¾ä¾‹ï¼Œç”¨æˆ·æäº¤äº†ä¸€ä¸ª DataX ä½œä¸šï¼Œå¹¶ä¸”é…ç½®äº†æ€»çš„å¹¶å‘æ•°ä¸º 20ï¼Œç›®çš„æ˜¯å¯¹ä¸€ä¸ªæœ‰ 100 å¼ åˆ†è¡¨çš„ MySQL è¿›è¡ŒåŒæ­¥ã€‚è°ƒåº¦å†³ç­–æ€è·¯æ˜¯ï¼š
>
> 1. dataX job æ ¹æ®åˆ†åº“åˆ†è¡¨åˆ‡åˆ†ç­–ç•¥ï¼Œå°†åŒæ­¥å·¥ä½œåˆ†æˆ 100 ä¸ª Taskã€‚
> 2. æ ¹æ®é…ç½®çš„æ€»çš„å¹¶å‘åº¦ 20ï¼Œä»¥åŠæ¯ä¸ª TaskGroup çš„å¹¶å‘åº¦ 5ï¼ŒdataXå…±éœ€è¦ 4 ä¸ª TaskGroupã€‚
> 3. 4 ä¸ª TaskGroup åˆ† 100 ä¸ª Taskï¼Œæ¯ä¸ª TaskGroup è´Ÿè´£ 25ä¸ª Taskã€‚

> åŒæ­¥ HDFS æ•°æ®åˆ° MySQL æ¡ˆä¾‹ï¼š
>
> é€‰ç”¨ HDFSReader å’Œ MySQLWriterï¼Œåˆ†åˆ«è®¾ç½® json é…ç½®æ–‡ä»¶ã€‚

> DataXä¼˜åŒ–ï¼š
>
> æå‡ DataX job å†… channel å¹¶å‘æ•°ï¼Œå†…å­˜çš„å ç”¨æ˜¾è‘—å¢åŠ ï¼Œæ¯ä¸ª channel ä¼šæœ‰ä¸€ä¸ª Bufferï¼Œä½œä¸ºä¸´æ—¶æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼Œè€Œåœ¨ reader å’Œ writer ä¸­ï¼Œä¹Ÿä¼šæœ‰ bufferï¼Œä¸ºäº†é˜²æ­¢ OOMï¼Œéœ€è¦è°ƒå¤§ JVM çš„å †å†…å­˜ã€‚
>
> è°ƒæ•´ JVM xms xmx å‚æ•°çš„ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ç›´æ¥æ›´æ”¹ datax.py è„šæœ¬ï¼›å¦ä¸€ç§æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™ï¼ŒåŠ ä¸Šå‚æ•°ï¼š
>
> `python datax/bin/datax.py --jvm="-Xms8G -Xmx8G" /path/to/your/job.json`

### Maxwell

> MySQL å˜æ›´æ•°æ®æŠ“å–è½¯ä»¶ï¼Œå®æ—¶ç›‘æ§ MySQL çš„ insertã€updateã€deleteã€‚å¹¶å°†å˜æ›´æ•°æ®å‘é€ç»™ Kafka ç­‰æµæ•°æ®å¤„ç†å¹³å°ã€‚

> åŸç†ï¼š
>
> è¯»å– MySQL çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinlogï¼‰ï¼Œä»ä¸­è·å–å˜æ›´æ•°æ®ã€‚

## æ•°æ®é‡‡é›†æ¨¡å—æ€»ç»“

### Linux

```shell
# å‘½ä»¤
top
ps -ef
df -h	#ç£ç›˜ç©ºé—´
netstat	#æŸ¥çœ‹ç«¯å£å·

# 4ä¸ªå·¥å…·
awk sed sort cut

# å†™è¿‡ä»€ä¹ˆè„šæœ¬
1. åŒæ­¥åˆ†å‘
2. å¯åŠ¨åœæ­¢
```

### Sqoop

> å¯¼å…¥æ•°æ®çš„æ–¹å¼ï¼š
>
> + å…¨é‡ï¼šwhere 1=1
> + å¢é‡ï¼šwhere åˆ›å»ºæ—¶é—´ = å½“å¤©
> + æ–°å¢åŠå˜åŒ–ï¼šwhere åˆ›å»ºæ—¶é—´ = å½“å¤© or æ“ä½œæ—¶é—´ = å½“å¤©
> + ç‰¹æ®Šï¼šåªå¯¼å…¥ä¸€æ¬¡

### Hadoop

> å¸¸ç”¨ç«¯å£å·ï¼š
>
> + 2.xï¼š50070/8020ï¼šHDFS   8088ï¼šä»»åŠ¡æƒ…å†µ   19888ï¼šJob history
> + 3.xï¼š9870/8020ï¼šHDFS   8088ï¼šä»»åŠ¡æƒ…å†µ   19888ï¼šJob history

> é…ç½®æ–‡ä»¶ï¼š
>
> + /etc/profile
> + 2.xï¼šcore-site.xml    hdfs-site.xml    yarn-site.xml    mapred-site.xml    slaves
> + 3.xï¼šcore-site.xml    hdfs-site.xml    yarn-site.xml    mapred-site.xml    workers

### HDFS

> HDFS çš„è¯»å†™æµç¨‹ï¼Œç¬”è¯•ï¼š
>
> å†™è¯¦ç»†æ­¥éª¤ï¼š
>
> 1. å®¢æˆ·ç«¯å‘NameNodeå‘å‡ºå†™æ–‡ä»¶è¯·æ±‚ã€‚
> 2. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æ–‡ä»¶ã€æ£€æŸ¥æƒé™ã€‚è‹¥é€šè¿‡æ£€æŸ¥ï¼Œç›´æ¥å…ˆå°†æ“ä½œå†™å…¥EditLogï¼Œå¹¶è¿”å›è¾“å‡ºæµå¯¹è±¡ã€‚ 
>    ï¼ˆæ³¨ï¼šWALï¼Œwrite ahead logï¼Œå…ˆå†™Logï¼Œå†å†™å†…å­˜ï¼Œå› ä¸ºEditLogè®°å½•çš„æ˜¯æœ€æ–°çš„HDFSå®¢æˆ·ç«¯æ‰§è¡Œæ‰€æœ‰çš„å†™æ“ä½œã€‚å¦‚æœåç»­çœŸå®å†™æ“ä½œå¤±è´¥äº†ï¼Œç”±äºåœ¨çœŸå®å†™æ“ä½œä¹‹å‰ï¼Œæ“ä½œå°±è¢«å†™å…¥EditLogä¸­äº†ï¼Œæ•…EditLogä¸­ä»ä¼šæœ‰è®°å½•ï¼Œæˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒåç»­clientè¯»ä¸åˆ°ç›¸åº”çš„æ•°æ®å—ï¼Œå› ä¸ºåœ¨ç¬¬5æ­¥ä¸­DataNodeæ”¶åˆ°å—åä¼šæœ‰ä¸€è¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œè‹¥æ²¡å†™æˆåŠŸï¼Œå‘é€ç«¯æ²¡æ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œä¼šä¸€ç›´é‡è¯•ï¼Œç›´åˆ°æˆåŠŸï¼‰
> 3. clientç«¯æŒ‰128MBçš„å—åˆ‡åˆ†æ–‡ä»¶ã€‚
> 4. clientå°†NameNodeè¿”å›çš„åˆ†é…çš„å¯å†™çš„DataNodeåˆ—è¡¨å’ŒDataæ•°æ®ä¸€åŒå‘é€ç»™æœ€è¿‘çš„ç¬¬ä¸€ä¸ªDataNodeèŠ‚ç‚¹ï¼Œæ­¤åclientç«¯å’ŒNameNodeåˆ†é…çš„å¤šä¸ªDataNodeæ„æˆpipelineç®¡é“ï¼Œclientç«¯å‘è¾“å‡ºæµå¯¹è±¡ä¸­å†™æ•°æ®ã€‚clientæ¯å‘ç¬¬ä¸€ä¸ªDataNodeå†™å…¥ä¸€ä¸ªpacketï¼Œè¿™ä¸ªpacketä¾¿ä¼šç›´æ¥åœ¨pipelineé‡Œä¼ ç»™ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªâ€¦DataNodeã€‚ 
>    ï¼ˆæ³¨ï¼šå¹¶ä¸æ˜¯å†™å¥½ä¸€ä¸ªå—æˆ–ä¸€æ•´ä¸ªæ–‡ä»¶åæ‰å‘ååˆ†å‘ï¼‰
> 5. æ¯ä¸ªDataNodeå†™å®Œä¸€ä¸ªå—åï¼Œä¼šè¿”å›ç¡®è®¤ä¿¡æ¯ã€‚ 
>    ï¼ˆæ³¨ï¼šå¹¶ä¸æ˜¯æ¯å†™å®Œä¸€ä¸ªpacketåå°±è¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œå› ä¸ºpacketä¸­çš„æ¯ä¸ªchunkéƒ½æºå¸¦æ ¡éªŒä¿¡æ¯ï¼Œæ²¡å¿…è¦æ¯å†™ä¸€ä¸ªå°±æ±‡æŠ¥ä¸€ä¸‹ï¼Œè¿™æ ·æ•ˆç‡å¤ªæ…¢ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å†™å®Œä¸€ä¸ªblockå—åï¼Œå¯¹æ ¡éªŒä¿¡æ¯è¿›è¡Œæ±‡æ€»åˆ†æï¼Œå°±èƒ½å¾—å‡ºæ˜¯å¦æœ‰å—å†™é”™çš„æƒ…å†µå‘ç”Ÿï¼‰
> 6. å†™å®Œæ•°æ®ï¼Œå…³é—­è¾“è¾“å‡ºæµã€‚
> 7. å‘é€å®Œæˆä¿¡å·ç»™NameNodeã€‚ 
>    ï¼ˆæ³¨ï¼šå‘é€å®Œæˆä¿¡å·çš„æ—¶æœºå–å†³äºé›†ç¾¤æ˜¯å¼ºä¸€è‡´æ€§è¿˜æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¼ºä¸€è‡´æ€§åˆ™éœ€è¦æ‰€æœ‰DataNodeå†™å®Œåæ‰å‘NameNodeæ±‡æŠ¥ã€‚æœ€ç»ˆä¸€è‡´æ€§åˆ™å…¶ä¸­ä»»æ„ä¸€ä¸ªDataNodeå†™å®Œåå°±èƒ½å•ç‹¬å‘NameNodeæ±‡æŠ¥ï¼ŒHDFSä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯å¼ºè°ƒå¼ºä¸€è‡´æ€§ï¼‰
>
> è¯»è¯¦ç»†æ­¥éª¤ï¼š
>
> 1. clientè®¿é—®NameNodeï¼ŒæŸ¥è¯¢å…ƒæ•°æ®ä¿¡æ¯ï¼Œè·å¾—è¿™ä¸ªæ–‡ä»¶çš„æ•°æ®å—ä½ç½®åˆ—è¡¨ï¼Œè¿”å›è¾“å…¥æµå¯¹è±¡ã€‚
> 2. å°±è¿‘æŒ‘é€‰ä¸€å°datanodeæœåŠ¡å™¨ï¼Œè¯·æ±‚å»ºç«‹è¾“å…¥æµ ã€‚
> 3. DataNodeå‘è¾“å…¥æµä¸­ä¸­å†™æ•°æ®ï¼Œä»¥packetä¸ºå•ä½æ¥æ ¡éªŒã€‚
> 4. å…³é—­è¾“å…¥æµ

> å°æ–‡ä»¶å±å®³ï¼š
>
> 1. å­˜å‚¨æ—¶é—´ï¼šå°æ–‡ä»¶ä¼šå ç”¨ namenode ä¸€æ•´ä¸ªåŒºå—ï¼Œä¸€ä¸ªæ–‡ä»¶å—150å­—èŠ‚ã€‚128gå†…å­˜çš„ namenode èƒ½å­˜å‚¨ 9äº¿ä¸ªæ–‡ä»¶å—ã€‚
> 2. è®¡ç®—æ—¶é—´ï¼š1ä¸ªæ–‡ä»¶å—å¼€å¯1ä¸ªmaptaskï¼Œä¸€ä¸ªmaptaskå°±æ˜¯1gå†…å­˜ã€‚
>
> å¦‚ä½•è§£å†³ï¼š
>
> 1. åˆå¹¶ï¼šCombineTextinputformat => å‡å°‘ maptask
> 2. harå½’æ¡£
> 3. JVMé‡ç”¨

> HDFS æœ‰å‡ ä¸ªå‰¯æœ¬ï¼š
>
> 3

> HDFS å—å¤§å°ï¼š
>
> 2.x 3.xï¼š128M

### Mapreduce

> shuffle åŠå…¶ä¼˜åŒ–ï¼š
>
> shuffle å®šä¹‰ï¼šmap æ–¹æ³•ä¹‹åï¼Œreduceæ–¹æ³•ä¹‹å‰æ··æ´—çš„è¿‡ç¨‹ã€‚
>
> map é˜¶æ®µä¹‹åï¼š
>
> 1. å…ˆè°ƒç”¨ getpartition æ–¹æ³•ï¼Œæ ‡è®°æ•°æ®æ˜¯å“ªä¸€ä¸ªåˆ†åŒºã€‚
> 2. è¿›å…¥ç¯å½¢ç¼“å†²åŒºï¼ˆç¼“å†²åŒºå¤§å°100M ï¼‰ï¼Œåˆ°è¾¾ 80% è¿›è¡Œæº¢å†™ï¼ˆæ’åºæ‰‹æ®µï¼šå¯¹ **key** çš„ç´¢å¼•æŒ‰ç…§ **å­—å…¸åº** è¿›è¡Œ **å¿«æ’**ï¼‰
> 3. å¯¹æº¢å†™æ–‡ä»¶è¿›è¡Œå½’å¹¶ï¼Œå†™åˆ°æŒ‡å®šç£ç›˜ï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜ã€‚
>
> reduce é˜¶æ®µä¹‹å‰ï¼š
>
> 1. æ‹‰å–ç£ç›˜ä¸ŠæŒ‡å®šçš„æ•°æ®ï¼Œæ”¾åˆ°å†…å­˜ä¸­ï¼ˆå†…å­˜ä¸å¤Ÿåœ¨ç£ç›˜ä¸­ï¼‰
> 2. reduce æ“ä½œ
>
> ä¼˜åŒ–ï¼š
>
> 1. getpartition æ–¹æ³•æ—¶ï¼šè‡ªå®šä¹‰åˆ†åŒºï¼šè§£å†³æ•°æ®å€¾æ–œé—®é¢˜ã€‚
>
> 2. è°ƒæ•´ç¼“å†²åŒºå¤§å°å’Œæº¢å†™é˜ˆå€¼ï¼Œç¼“å†²åŒºå¤§å°ç”±100Mè°ƒæ•´åˆ°200Mï¼Œæº¢å†™é˜ˆå€¼ç”±80%è°ƒæ•´åˆ°90%ã€‚äº§ç”Ÿå¤§é‡çš„æº¢å†™æ–‡ä»¶ï¼Œä½¿ç”¨combinerèšç±»æ–‡ä»¶ï¼ˆå‰ææ˜¯ä¸å½±å“æœ€ç»ˆä¸šåŠ¡é€»è¾‘ï¼‰ã€‚è¿™æ ·å‡å°‘äº†å†™æ–‡ä»¶çš„ä¸ªæ•°ï¼Œåˆå¹¶ä¼šå¿«ä¸€äº›ã€‚
>
> 3. æº¢å†™æ–‡ä»¶å½’å¹¶åˆ°ç£ç›˜ï¼šå‡å°‘ç£ç›˜IOå‹ç¼©ï¼Œä½¿ç”¨å¿«çš„å‹ç¼©ç®—æ³•ï¼šsnappy/lzo
>
> 4. 
>
> 5. |                                                    | Map  |        | Reduce |                                                              |
>    | -------------------------------------------------- | ---- | ------ | ------ | ------------------------------------------------------------ |
>    | è¾“å…¥ç«¯                                             |      | å¿«     |        | è¾“å‡ºç«¯                                                       |
>    | å…ˆè€ƒè™‘æ•°æ®é‡<br>1.å° => å¿«                         |      | snappy |        | çœ‹éœ€æ±‚<br>1.æ°¸ä¹…ä¿å­˜ï¼šå‹ç¼©è¶Šå°è¶Šå¥½                           |
>    | 2.æ•°æ®é‡å¤§ => åˆ‡ç‰‡<br>bzip2<br>lzo => éœ€è¦åˆ›å»ºç´¢å¼• |      | lzo    |        | 2.ä¸‹ä¸€ä¸ªmapreduceè¾“å…¥ç«¯<br>æ•°æ®é‡å° => å¿«<br>æ•°æ®é‡å¤§ => åˆ‡ç‰‡ å‹ç¼© |
>
> 6. reduce æ‹‰å–ç£ç›˜æŒ‡å®šçš„æ•°æ®ï¼Œé»˜è®¤æ‹‰å–5ä¸ªï¼Œå¯ä»¥æ”¹æˆ10 - 20ä¸ª
>
> 7. yarn å’Œ hadoopå†…å­˜å¤§å°è°ƒæ•´ï¼š**å•ä¸ªä»»åŠ¡å¯ä»¥ç”³è¯·çš„æœ€å¤§å†…å­˜å¤§å°**ï¼Œå’Œ **Hadoop å•ä¸ªèŠ‚ç‚¹å¯ç”¨å†…å­˜å¤§å°**ã€‚è°ƒèŠ‚è¿™ä¸¤ä¸ªå‚æ•°èƒ½æé«˜ç³»ç»Ÿå†…å­˜çš„åˆ©ç”¨ç‡ã€‚ ï¼ˆNodeManager é»˜è®¤å†…å­˜å¤§å° 8gï¼Œå•ä¸ªä»»åŠ¡é»˜è®¤å†…å­˜å¤§å° 8gï¼Œmaptaské»˜è®¤å†…å­˜å¤§å° 1gï¼Œreducetaské»˜è®¤å†…å­˜å¤§å° 1gã€‚ï¼‰NodeManagerå†…å­˜æ”¹ä¸ºèŠ‚ç‚¹ 80% å·¦å³çš„å†…å­˜å¤§å°ã€‚å•ä¸ªä»»åŠ¡å†…å­˜å¤§å°æ ¹æ®æ¯ 128M æ•°æ®åˆ†é…1gå†…å­˜ã€‚maptask å’Œ reducetask å†…å­˜è‹¥ä¸æ”¯æŒå‹ç¼©ä¹Ÿéœ€è¦è°ƒå¤§ã€‚

> è¿›è¡Œäº†å‡ æ¬¡æ’åºï¼š
>
> mapåè¿›è¡Œä¸€æ¬¡å¿«æ’ï¼Œä¸€æ¬¡å½’å¹¶ã€‚
>
> reduceæ—¶è¿›è¡Œä¸€æ¬¡å½’å¹¶ï¼Œä¸€æ¬¡åˆ†ç»„ã€‚

### Yarn

>yarn çš„å·¥ä½œæœºåˆ¶ï¼š
>
>1. ç”¨æˆ·ä½¿ç”¨å®¢æˆ·ç«¯å‘ RM æäº¤ä¸€ä¸ªä»»åŠ¡ï¼ŒåŒæ—¶æŒ‡å®šæäº¤åˆ°å“ªä¸ªé˜Ÿåˆ—å’Œéœ€è¦å¤šå°‘èµ„æºã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ¯ä¸ªè®¡ç®—å¼•æ“çš„å¯¹åº”å‚æ•°è®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šï¼Œåˆ™ä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚
>
>2. RM åœ¨æ”¶åˆ°ä»»åŠ¡æäº¤çš„è¯·æ±‚åï¼Œå…ˆæ ¹æ®èµ„æºå’Œé˜Ÿåˆ—æ˜¯å¦æ»¡è¶³è¦æ±‚é€‰æ‹©ä¸€ä¸ª NMï¼Œé€šçŸ¥å®ƒå¯åŠ¨ä¸€ä¸ªç‰¹æ®Šçš„ containerï¼Œç§°ä¸º ApplicationMasterï¼ˆAMï¼‰ï¼Œåç»­æµç¨‹ç”±å®ƒå‘èµ·ã€‚
>
>3. AM å‘ RM æ³¨å†Œåæ ¹æ®è‡ªå·±ä»»åŠ¡çš„éœ€è¦ï¼Œå‘ RM ç”³è¯· containerï¼ŒåŒ…æ‹¬æ•°é‡ã€æ‰€éœ€èµ„æºé‡ã€æ‰€åœ¨ä½ç½®ç­‰å› ç´ ã€‚
>
>4. å¦‚æœé˜Ÿåˆ—æœ‰è¶³å¤Ÿèµ„æºï¼ŒRM ä¼šå°† container åˆ†é…ç»™æœ‰è¶³å¤Ÿå‰©ä½™èµ„æºçš„ NMï¼Œç”± AM é€šçŸ¥ NM å¯åŠ¨ containerã€‚
>
>5. container å¯åŠ¨åæ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ï¼Œå¤„ç†åˆ†ç»™è‡ªå·±çš„æ•°æ®ã€‚NM é™¤äº†è´Ÿè´£å¯åŠ¨ containerï¼Œè¿˜è´Ÿè´£ç›‘æ§å®ƒçš„èµ„æºä½¿ç”¨çŠ¶å†µä»¥åŠæ˜¯å¦å¤±è´¥é€€å‡ºç­‰å·¥ä½œï¼Œå¦‚æœ container å®é™…ä½¿ç”¨çš„å†…å­˜è¶…è¿‡ç”³è¯·æ—¶æŒ‡å®šçš„å†…å­˜ï¼Œä¼šå°†å…¶æ€æ­»ï¼Œä¿è¯å…¶ä»– container èƒ½æ­£å¸¸è¿è¡Œã€‚
>
>6. å„ä¸ª container å‘ AM æ±‡æŠ¥è‡ªå·±çš„è¿›åº¦ï¼Œéƒ½å®Œæˆåï¼ŒAM å‘ RM æ³¨é”€ä»»åŠ¡å¹¶é€€å‡ºï¼ŒRM é€šçŸ¥ NM æ€æ­»å¯¹åº”çš„ containerï¼Œä»»åŠ¡ç»“æŸã€‚

> hadoop è°ƒåº¦å™¨ï¼š
>
> 1. ä¸‰ç§è°ƒåº¦å™¨ï¼šFIFOã€å®¹é‡è°ƒåº¦å™¨ã€å…¬å¹³è°ƒåº¦å™¨
> 2. Apacheé»˜è®¤è°ƒåº¦å™¨ï¼šå®¹é‡è°ƒåº¦å™¨ï¼ˆapacheé»˜è®¤èµ„æºå¾ˆå°ï¼‰
> 3. CDHé»˜è®¤è°ƒåº¦å™¨ï¼šå…¬å¹³è°ƒåº¦å™¨
> 4. ç‰¹ç‚¹ï¼š
>    1. FIFOè°ƒåº¦å™¨ç‰¹ç‚¹ï¼šæ”¯æŒå•é˜Ÿåˆ—ï¼Œä»»åŠ¡å…ˆè¿›å…ˆå‡ºï¼Œä¼ä¸šä¸­å‡ ä¹ä¸ç”¨ã€‚
>    2. å®¹é‡è°ƒåº¦å™¨ï¼šåº•å±‚æ˜¯FIFOè°ƒåº¦å™¨ã€‚æ”¯æŒå¤šé˜Ÿåˆ—ï¼Œå¯ä»¥å€Ÿç”¨å…¶ä»–é˜Ÿåˆ—èµ„æºã€‚å…ˆè¿›å…¥çš„ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œã€‚
>    3. å…¬å¹³è°ƒåº¦å™¨ï¼šæ”¯æŒå¤šé˜Ÿåˆ—(å¹¶å‘åº¦æ¯”å®¹é‡è°ƒåº¦é«˜)ï¼Œå¯ä»¥å€Ÿç”¨å…¶ä»–é˜Ÿåˆ—èµ„æºã€‚é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡å…¬å¹³äº«æœ‰é˜Ÿåˆ—èµ„æºã€‚
> 5. å®¹å™¨è°ƒåº¦å™¨é…ç½®å¤šé˜Ÿåˆ—ï¼š
>    1. æŒ‰ç…§åˆ†æå¼•æ“åˆ›å»ºé˜Ÿåˆ—ï¼šmrã€sparkã€flinkã€hive
>    2. æŒ‰ç…§ä¸šåŠ¡ï¼šç™»å½•ã€æ³¨å†Œã€è´­ç‰©è½¦ã€ä¸‹å•ã€æ”¯ä»˜

### Zookeeper

> é€‰ä¸¾æœºåˆ¶ï¼š
>
> 1. åŠæ•°æœºåˆ¶ï¼š3å°æœåŠ¡å™¨ï¼Œ2å°æŠ•è°è°å°±æ˜¯è€å¤§

> å¸¸ç”¨å‘½ä»¤ï¼š
>
> `delete create`

> å®‰è£…å°æ•°ï¼š
>
> æ ¹æ®é›†ç¾¤æœºå™¨æ•°é‡ï¼Œ3-11å°ã€‚zkå°æ•°å¤šäº†ï¼Œå¢åŠ å¯é æ€§ï¼Œä½†é™ä½é€‰ä¸¾æ•ˆç‡ã€‚

### Flume

> ç»„æˆï¼šï¼ˆsourceã€channelã€sinkã€putäº‹åŠ¡ã€takeäº‹åŠ¡ï¼‰
>
> 1. sourceï¼šï¼ˆTaildirsourceï¼‰
>    1. ä¼˜ç‚¹ï¼šæ–­ç‚¹ç»­ä¼ ã€å¤šç›®å½•ï¼Œå®æ—¶ç›‘æ§ã€‚ç¼ºç‚¹ï¼šæ–‡ä»¶åæ›´å(å¦‚log4jå°±æ˜¯æ›´åçš„æ—¥å¿—æ¡†æ¶)ä¹‹åé‡æ–°è¯»å–è¯¥æ–‡ä»¶é€ æˆé‡å¤ã€‚æ³¨æ„ï¼šè®©Taildirsourceåˆ¤æ–­æ–‡ä»¶æ—¶åªçœ‹iNodeå€¼
>    2. Apache 1.7ã€CDH1.6ç‰ˆæœ¬äº§ç”Ÿçš„
>    3. æ²¡æœ‰æ–­ç‚¹ç»­ä¼ æ€ä¹ˆåŠï¼šè‡ªå®šä¹‰ sourceï¼Œè¯»å–çš„ä½ç½®å§‹ç»ˆæŒä¹…åˆ°ç£ç›˜ä¸Š
>    4. æŒ‚äº†ï¼šä¸ä¼šä¸¢æ•°æ®ï¼Œä½†æœ‰å¯èƒ½é‡å¤æ•°æ®
>    5. å¦‚ä½•å¤„ç†é‡å¤æ•°æ®ï¼šä¸å¤„ç†æˆ–ä¸‹ä¸€çº§å¤„ç†ï¼Œé‡‡ç”¨äº‹åŠ¡æ–¹å¼æ•ˆç‡å¤ªä½
>    6. ä¸æ”¯æŒé€’å½’éå†æ–‡ä»¶å¤¹ï¼šè‡ªå®šä¹‰é€’å½’
> 2. channelï¼šï¼ˆKafkaChannelï¼‰
>    1. ä¼˜ç‚¹ï¼šå°†æ•°æ®å†™å…¥Kafkaï¼Œçœäº†ä¸€å±‚sink
>    1. file channel ç£ç›˜|å¯é æ€§é«˜|æ€§èƒ½ä½
>    2. memory channel å†…å­˜|å¯é æ€§ä½|æ€§èƒ½é«˜
>    3. kafka channel å­˜kafkaé‡Œï¼Œkafkaå­˜åœ¨ç£ç›˜|å¯é æ€§é«˜|æ€§èƒ½ä¼˜äº memory channel + kafka sink
> 3. sinkï¼šï¼ˆHDFS sinkï¼‰
>    1. ç”¨æ¥è§£å†³å°æ–‡ä»¶é—®é¢˜
>    2. è®¾ç½®å¤§å°128Mã€æ—¶é—´ï¼ˆ1-2å°æ—¶ï¼‰ã€eventä¸ªæ•°ç¦æ­¢0

> KafkaChannelï¼šåœ¨kafkaä¸­æ—¢å¯ä»¥ç”Ÿäº§è€…ä¹Ÿå¯ä»¥ä½œä¸ºæ¶ˆè´¹è€…
> ç”¨æ³•ï¼š
>
> 1. source - kafkachannel - sink
> 2. source - kafkachannelï¼ˆä½œä¸ºæ¶ˆè´¹è€…ï¼‰
> 3. kafkachannel - sinkï¼ˆä½œä¸ºç”Ÿäº§è€…ï¼‰

> ä¸‰ä¸ªå™¨ï¼šï¼ˆæ‹¦æˆªå™¨ã€é€‰æ‹©å™¨ã€ç›‘æ§å™¨ï¼‰
>
> 1. æ‹¦æˆªå™¨ï¼šæ—¶é—´æˆ³æ‹¦æˆªå™¨ æˆ–è€… è‡ªå®šä¹‰æ‹¦æˆªå™¨
> 2. é€‰æ‹©å™¨ï¼šé»˜è®¤æ˜¯replicatingï¼ŒæŠŠæ•°æ®å‘å¾€ä¸‹ä¸€çº§æ‰€æœ‰é€šé“
> 3. ç›‘æ§å™¨ï¼šg, ç›‘æ§ putã€take äº‹åŠ¡å°è¯•æäº¤çš„æ¬¡æ•°è¿œè¿œå¤§äºæœ€ç»ˆæäº¤æˆåŠŸçš„æ¬¡æ•°ï¼Œè¯´æ˜ flume å¼‚å¸¸ã€‚è‡ªèº«ï¼šå¢åŠ å†…å­˜ï¼Œå…¶ä»–ï¼šå¢åŠ  flume å°æ•°

> ä¼˜åŒ–ï¼š
>
> 1. file channel èƒ½é…ç½®å¤šç›®å½•å°±é…ç½®å¤šç›®å½•ï¼ˆä¸åŒç£ç›˜ï¼‰
> 2. ä½¿ç”¨ HDFS sink ç”¨æ¥è§£å†³å°æ–‡ä»¶é—®é¢˜
> 3. é€šè¿‡ç›‘æ§å™¨æ‰¾å¯»åŸå› ï¼Œå¢åŠ å†…å­˜å’Œå°æ•°

> æŒ‚äº†æ¢å¤ï¼š
>
> 1. channel æŒ‚äº†ï¼šmemory channel 100ä¸ªevent æ•°æ®ä¸¢å¤±ã€‚ï¼ˆfile channel 100ä¸‡ä¸ªeventï¼Œæ²¡æœ‰ä¸¢å¤±é£é™©ï¼‰
> 2. taildir source æŒ‚äº†ï¼šä¸ä¼šä¸¢æ•°ï¼Œå¯èƒ½é‡å¤æ•°æ®

### Kafka

> åŸºæœ¬ä¿¡æ¯ï¼š
>
> 1. ç»„æˆï¼š
>    1. producerï¼š
>       1. ACKï¼š0   1   -1
>       2. æ‹¦æˆªå™¨ï¼Œåºåˆ—åŒ–å™¨ï¼Œåˆ†åŒºå™¨
>       3. å‘é€æµç¨‹
>       4. å¹‚ç­‰æ€§ï¼Œäº‹åŠ¡
>       5. åˆ†åŒºè§„åˆ™ï¼š æœ‰æŒ‡å®šåˆ†åŒºåˆ™å‘å¾€æŒ‡å®šåˆ†åŒº ï¼›æ²¡æœ‰æŒ‡å®šåˆ†åŒºï¼Œåˆ™æ ¹æ®keyå€¼Hashï¼›æ²¡æœ‰æŒ‡å®šåˆ†åŒºä¹Ÿæ²¡æœ‰keyçš„æ—¶å€™ï¼Œè½®è¯¢ï¼ˆç²˜æ€§ï¼‰
>    2. brokerï¼š
>       1. Topicï¼šå‰¯æœ¬ï¼ˆé«˜å¯é ï¼‰
>          1. ISRï¼šLEOã€HW
>       2. åˆ†åŒºï¼ˆé«˜å¹¶å‘ï¼Œè´Ÿè½½å‡è¡¡ï¼Œé˜²æ­¢çƒ­ç‚¹ï¼‰
>    3. consumer
>       1. åˆ†åŒºåˆ†é…è§„åˆ™
>       2. offsetä¿å­˜ï¼š
>          1. é»˜è®¤ï¼š__consumer\_offsetsä¸»é¢˜ã€‚
>          2. å…¶ä»–ï¼šæ‰‹åŠ¨ç»´æŠ¤Offsetï¼ˆMySQLï¼‰
>          3. ä¿å­˜æ•°æ®&ä¿å­˜Offsetå†™åˆ°ä¸€ä¸ªäº‹ç‰©
>          4. ç²¾å‡†ä¸€æ¬¡æ¶ˆè´¹
>          5. å…ˆä¿å­˜æ•°æ®åä¿å­˜Offset   é‡å¤æ•°æ®+å¹‚ç­‰æ€§ï¼ˆç²¾å‡†ä¸€æ¬¡æ¶ˆè´¹ï¼‰
>          6. å…ˆä¿å­˜Offsetåä¿å­˜æ•°æ®   ä¸¢å¤±æ•°æ®
>    4. zkï¼šå­˜æ”¾ brokerï¼ˆid, topicï¼‰ï¼Œconsumerï¼ˆç›¸åº”çš„ offsetï¼‰ï¼Œæ²¡æœ‰ç”Ÿäº§è€…ä¿¡æ¯
> 2. å®‰è£…å°æ•°ï¼š`2 * (ç”Ÿäº§è€…å³°å€¼ç”Ÿäº§é€Ÿç‡(å‹æµ‹) * å‰¯æœ¬ / 100) + 1`, 
>    1. å…ˆä½¿ç”¨3å°æœºå™¨å‹æµ‹
> 3. å‰¯æœ¬æ•°ï¼šé€šå¸¸2ä¸ªå‰¯æœ¬ï¼Œé»˜è®¤1ä¸ªå‰¯æœ¬ã€‚å¤šï¼šå¯é æ€§é«˜ï¼Œä¼ è¾“æ€§èƒ½å·®
> 4. æ•°æ®é‡ï¼š100ä¸‡æ—¥æ´» ä¸€äºº100æ¡ ä¸€æ¡1kã€‚ 1M/s
> 5. æ•°æ®ä¿å­˜å¤šä¹…ï¼š3å¤©
> 6. ç£ç›˜é¢„ç•™ï¼š100g(ä¸€å¤©æ•°æ®) * 2ä¸ªå‰¯æœ¬ * 3å¤© / 0.7
> 7. ç›‘æ§ï¼škafka egaleï¼šå¼€æºæ¡†æ¶
> 8. åˆ†åŒºï¼šæé«˜å¹¶å‘åº¦ï¼šå…ˆè®¾ç½®1ä¸ªï¼Œé€šè¿‡å‹æµ‹ç”Ÿäº§è€…å³°å€¼ç”Ÿäº§é€Ÿç‡tpã€æ¶ˆè´¹è€…å³°å€¼æ¶ˆè´¹é€Ÿç‡tc
>    1. æœŸæœ›ååé‡t 100m/s
>    2. åˆ†åŒºæ•° = t / min (tp, tc)
> 9. åˆ†åŒºåˆ†é…ç­–ç•¥ï¼š
>    1. range é»˜è®¤
>    2. roundrobin é‡‡ç”¨ roundrobin æ‰€æœ‰æ•°æ®é‡‡ç”¨ hash æ–¹å¼å¤§æ•£ï¼Œå†é‡‡ç”¨è½®è¯¢çš„æ–¹å¼æ‰§è¡Œ
> 10. isrï¼šä¸»è¦è§£å†³leaderæŒ‚äº†è°å½“è€å¤§ï¼Œåœ¨ isr é˜Ÿåˆ—çš„éƒ½æœ‰æœºä¼šå½“è€å¤§ã€‚
> 11. å¤šå°‘ä¸ª topicï¼šæ»¡è¶³ä¸‹ä¸€çº§æ¶ˆè´¹è€…å³å¯ã€‚

> æŒ‚äº†:
>
> 1. çŸ­æœŸï¼šflume channel ç¼“å†²æ•°æ®
> 2. é•¿æœŸï¼šæ—¥å¿—æœåŠ¡å™¨ä¿ç•™30å¤©æ—¥å¿—

> ä¸¢ï¼šack é…ç½®å‚æ•°
>
> + 0ï¼šå‘é€æ•°æ®ï¼Œä¸éœ€è¦åº”ç­”ã€‚å¯é æ€§æœ€å·®ï¼Œä¼ è¾“æ€§èƒ½æœ€å¥½ã€‚
> + 1ï¼šå‘é€æ•°æ®ï¼Œleader åº”ç­”ã€‚å¯é æ€§ä¸€èˆ¬ï¼Œä¼ è¾“æ€§èƒ½ä¸€èˆ¬ã€‚
> + -1ï¼šå‘é€æ•°æ®ï¼Œleader å’Œ follower å…±åŒåº”ç­”ã€‚å¯é æ€§æœ€é«˜ï¼Œä¼ è¾“æ€§èƒ½æœ€å·®ã€‚
> + ä¼ä¸šä¸­ï¼š0å‡ ä¹ä¸ç”¨ï¼Œä¸å¤ªé‡è¦1ï¼Œé‡è¦-1

> é‡å¤ï¼š
>
> 1. é‡‡ç”¨ äº‹åŠ¡ã€å¹‚ç­‰æ€§ã€ack = -1
>    1. å¹‚ç­‰æ€§ï¼šå•åˆ†åŒºå•ä¼šè¯å†…æ•°æ®ä¸é‡å¤
>    2. äº‹åŠ¡ï¼šæ¯æ¡æ•°æ®æ¯”è¾ƒï¼Œå¯ä»¥æ¯”è¾ƒå¤šä¸ªåˆ†åŒº
>    3. äº‹åŠ¡ï¼š
> 2. åœ¨ä¸‹ä¸€çº§å¤„ç†ï¼š

> ç§¯å‹ï¼škafka ä¿å­˜æ•°æ®çš„æ—¶é—´æ˜¯æœ‰é™çš„ï¼Œæ²¡æœ‰åŠæ—¶æ¶ˆè´¹å®Œ
>
> 1. å¢åŠ åˆ†åŒºï¼ŒåŒæ—¶å¢åŠ æ¶ˆè´¹è€…å¯¹åº”çš„CPUæ ¸æ•°
> 2. å¢åŠ æ¶ˆè´¹è€… batchsize

> ä¼˜åŒ–ï¼š
>
> 1. æ—¥å¿—ä¿å­˜3å¤©
> 2. å¢åŠ ç½‘ç»œé€šä¿¡å»¶è¿Ÿæ—¶é—´

> 1. é«˜æ•ˆè¯»å†™åŸå› ï¼š
>    1. é›†ç¾¤ï¼Œåˆ†åŒº
>    2. é¡ºåºè¯»å†™600m/s(vip)ï¼Œéšæœºè¯»å†™100m/s
>    3. é›¶æ‹·è´
> 2. ä¼ è¾“ä¸€æ¡2mæ—¥å¿—æ–‡ä»¶ï¼Œç°è±¡ï¼šå¡ä½ã€‚è°ƒæ•´ä¸¤ä¸ªå‚æ•°å¤§å°
> 3. æ•°æ®è¿‡æœŸï¼šåˆ é™¤ æˆ–è€… å‹ç¼©ï¼Œé€šå¸¸åˆ é™¤ï¼Œå‰¯æœ¬å¤‡ä»½30å¤©æ•°æ®

### Hive

> ç»„æˆï¼š![hive_structure](hive_structure.jpg "hive_structure")

> å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨åŒºåˆ«ï¼š
>
> 1. å†…éƒ¨è¡¨åˆ é™¤æ•°æ®ï¼šå…ƒæ•°æ®ã€åŸå§‹æ•°æ® åˆ æ‰
> 2. å¤–è¡¨åˆ æ•°æ®ï¼šå…ƒæ•°æ®åˆ æ‰ï¼ŒåŸå§‹æ•°æ®ä¿ç•™
> 3. åªæœ‰è‡ªå·±ä¸´æ—¶ä½¿ç”¨è¡¨ï¼Œåˆ›å»ºå†…éƒ¨è¡¨ã€‚ç»å¤§éƒ¨åˆ†åœºæ™¯éƒ½æ˜¯å¤–éƒ¨è¡¨

> 4ä¸ªbyï¼š
>
> order byï¼šå…¨å±€æ’åº ï¼ˆåªæœ‰ä¸€ä¸ªreduce taskï¼Œæ•°æ®å€¾æ–œï¼Œèµ„æºåˆ†é…ä¸è¶³ï¼‰ä¸ä½¿ç”¨
>
> sort byï¼šå±€éƒ¨æ’åºï¼Œåªä¿è¯æ¯ä¸ª reducer task è¾“å‡ºæœ‰åº
>
> distribute byï¼šåˆ†æ¡¶ï¼Œå–ä½™åˆ†ç»„ï¼Œæ²¡æœ‰æ’åº
>
> cluster byï¼š distribute by + sort by

> è‡ªå®šä¹‰å‡½æ•°ï¼š
>
> 1. è‡ªå®šä¹‰udfå‡½æ•°æ­¥éª¤ï¼š 1è¿›1å‡ºï¼Œä¸€è¡Œï¼Œå®šä¹‰ç±» ç»§æ‰¿udfï¼Œé‡å†™ evaluate æ–¹æ³•
> 2. è‡ªå®šä¹‰udtfå‡½æ•°æ­¥éª¤ï¼šå¤šè¿›å¤šå‡ºï¼Œç»§æ‰¿ udtfï¼Œé‡å†™ä¸‰ä¸ªæ–¹æ³•ï¼ˆåˆå§‹åŒ–ï¼ˆå®šä¹‰åç§°ã€æ ¡éªŒè¿”å›å€¼ç±»å‹ï¼‰ã€closeã€processï¼‰ã€‚æ‰“åŒ…+ä¸Šä¼ hdfs+åœ¨hiveå®¢æˆ·ç«¯åˆ›å»º

> çª—å£å‡½æ•°ï¼šrankã€overã€topn

> ä¼˜åŒ–ï¼š
>
> 1. è¡Œåˆ—è¿‡æ»¤ï¼šjoin -> where => where -> join
> 2. åˆ†åŒº
> 3. å°æ–‡ä»¶ï¼šcombineHiveInputformat æˆ–è€… JVMé‡ç”¨ æˆ–è€… merge
> 4. å‹ç¼©

## æ•°æ®ä»“åº“

### æ•°æ®åˆ†å±‚

> + ODSï¼ˆOperation Data Storeï¼‰åŸå§‹æ•°æ®å±‚ï¼šå­˜æ”¾åŸå§‹æ•°æ®ï¼Œèµ·åˆ°å¤‡ä»½çš„ä½œç”¨
> + DWDï¼ˆData Warehouse Detailï¼‰æ˜ç»†æ•°æ®å±‚ï¼šæ¸…æ´—ï¼Œå»ç©ºï¼Œå»è„æ•°æ®ï¼Œç»´åº¦é€€åŒ–
> + DWSï¼ˆDW serviceï¼‰æŒ‰å¤©è¿›è¡Œè½»åº¦æ±‡æ€»
> + DWTï¼ˆDW Topicï¼‰æŒ‰ä¸»é¢˜è¿›è¡Œæ±‡æ€»
> + ADSï¼ˆApplication Data Storeï¼‰ä¸ºå„ç§ç»Ÿè®¡æŠ¥è¡¨æä¾›æ•°æ®

### æ•°ä»“å»ºæ¨¡

> ODSå±‚ï¼š
>
> + åˆ›å»ºæ”¯æŒLZOå‹ç¼©çš„è¡¨ï¼šå‡å°‘å­˜å‚¨ç©ºé—´ï¼Œ100g -> 10g - 5g(å–å†³äºæ–‡ä»¶æ ¼å¼ï¼Œæ¯”å¦‚JSONçš„åµŒå¥—æ–¹å¼ï¼ŒCSVçš„åˆ—æ•°é‡)
> + åˆ›å»ºåˆ†åŒºè¡¨ï¼šé˜²æ­¢å…¨è¡¨æ‰«æï¼ˆå¯¼æ•°æ®ï¼šå…¨é‡ã€å¢é‡ã€æ–°å¢å’Œå˜åŒ–ï¼‰
> + ä¿æŒæ•°æ®åŸè²Œä¸åšä»»ä½•ä¿®æ”¹ï¼Œèµ·åˆ°å¤‡ä»½æ•°æ®çš„ä½œç”¨

> DWDå±‚ï¼šğŸ”¶
>
> + é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹ -> å£°æ˜ç²’åº¦ -> ç¡®è®¤ç»´åº¦ -> ç¡®è®¤äº‹å®
> + ä¸šåŠ¡è¿‡ç¨‹ï¼šå“ªäº›åè®®éœ€è¦åšå¤„ç†
> + å£°æ˜ç²’åº¦ï¼šç²’åº¦å¯ä»¥æ˜¯å¤©ã€ä¸€äººã€åŒºåŸŸ
> + ç¡®è®¤ç»´åº¦ï¼šæ—¶é—´ç»´åº¦ã€åœ°åŒºç»´åº¦ã€ç”¨æˆ·ç»´åº¦
> + ç¡®è®¤äº‹å®ï¼šä¸šåŠ¡ä¸­çš„åº¦é‡å€¼ï¼ˆæ¬¡æ•°ã€ä¸ªæ•°ã€ä»¶æ•°ã€é‡‘é¢ã€å¯ä»¥è¿›è¡Œç´¯åŠ ï¼‰

> DWSå±‚ï¼š
>
> + å¯¹å„ä¸ªä¸»é¢˜å¯¹è±¡è¿›è¡Œç»Ÿè®¡ï¼šå¤©ã€æœˆã€å¹´ã€åœ°åŒºã€ç”¨æˆ·

> DWTå±‚ï¼š
>
> + ç»Ÿè®¡ç´¯è®¡è¡Œä¸ºï¼šä»å¼€å§‹åˆ°ç»“æŸï¼Œæ€»ç»“è¡¨

### æ•°æ®å¤„ç†

> æ•°æ®å¤„ç†å¤§è‡´åˆ†ä¸ºä¸¤å¤§ç±»ï¼š
>
> + OLTPï¼ˆon-line transaction processingï¼‰è”æœºäº‹åŠ¡å¤„ç†
> + OLAPï¼ˆon-line Analytical Processingï¼‰è”æœºåˆ†æå¤„ç†
